![表紙](../covers/hazimetenoOS.jpg)
## はじめてのOSコードリーディング UNIX V6で学ぶカーネルのしくみ


コンピューターのハードに寄り添った部分から理解するために読み始めた。さまざまなメモ等残していけたらと思う。


> PDP-11/40は専用のI/Oバスを持たずにUnibusという18ビットのアドレスバスを持つバスを入出力に用います。PDP11/40や周辺デバイスのレジスタメモリの最上位8Kバイトにマッピングし、メモリ操作を行うのと同様の方法でそれらのレジスタを操作します。これをMemoryMapped I/Oと呼びます。 (p29)

I/OとはInput/Outputの略であり、内部と外部のやり取りについて指すようだ。バスとはデータをやり取りする通り道である。Unibus は、DECがPDP-11向けに作った 特定のバス規格/実装名でありメモリもI/Oも同じバスでつなぐそうだ。通常はメモリとI/Oは別のバスということだがPDP-11/40は特殊でUnibusと言われる統一のバスでデータをやり取りするようだ。別のアドレス空間を持つIsolated I/Oや専用のI/OアドレスでアクセスするPort-Mapped I/Oというものもあるようだ。
レジスタとはCPUなどのデバイス内部に設置せれている高速だが低容量なメモリのことであり、それらにメモリアドレスを割り当てることでCPUからは普通のメモリと同じ方法でアクセスすることができる。ただ読むと「装置の状態」が返る、書くと「装置が動作する」など、副作用があったりキャッシュさせない、順序を守るなどの制約があるようだ。



> PSWといはプロセッサの状態を表します。　(p30)

CPU状態＋制御を表すレジスタ。汎用レジスタとは別に存在している。ユーザモードからはPSW全体を自由に変更できない。


| 名前                             | 役割（要点）                                                    |
| ------------------------------ | --------------------------------------------------------- |
| **PSW**（Processor Status Word） | 条件コード（N/Z/V/C）＋ 実行モード（ユーザ/カーネル）＋ 割り込み優先度（IPL）など、CPUの状態と制御 |

| 名前     | 別名/慣習                     | 役割（要点）                              |
| ------ | ------------------------- | ----------------------------------- |
| **R0** |                           | 演算・一時値・戻り値などに使われやすい              |
| **R1** |                           | 演算・一時値                           |
| **R2** |                           | ローカル処理                                 |
| **R3** |                           | ローカル処理                                  |
| **R4** |                           | ローカル処理                                  |
| **R5** | FP（Frame Pointer）として使われがち | フレームポインタ/環境ポインタ（命令上は汎用）       |
| **R6** | **SP**（Stack Pointer）     | スタックポインタと呼ばれスタックの先頭を表す。 |
| **R7** | **PC**（Program Counter）   | プログラムカウンタ。事実上固定                  |


> MMUはアドレス変換やアクセス権限の管理などを行います。　(p32)

実際に存在する。




テキストセグメント：読み取り専用。命令語である機械語が保存されている。

データセグメント：変数などが保存されている。複数のプロセス間で共有されることはない。（別のプログラムの動作が他のプログラムの動作に影響を与えてしまうから。）以下の3つから構成されている。
    PPDA：user構造体とカーネルスタック領域からなる。ユーザーからアクセスできず、カーネル処理の作業領域
    データ領域：静的な変数が置かれる領域とヒープ領域からなる。システムコールによってヒープ領域の拡張可能。
    スタック領域：関数の引数やローカルデータなどを一時的に格納。必要であればサイズ可変。



---
title: "はじめてのOSコードリーディング ~UNIX V6で学ぶカーネルのしくみ"
date: 2026-01-28 ~ 2026/
cover: "/covers/hazimetenoOS.jpg"
---
